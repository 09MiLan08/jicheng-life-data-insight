<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>成都景点游客统计</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
      body {
        margin: 20px;
      }
      .chart {
        width: 100%;
        height: 400px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <h1>成都景点游客数据</h1>
    <div id="line" class="chart"></div>
    <div id="pie" class="chart"></div>

    <script>
      // 正确的链式调用：fetch → then → then → catch
      fetch("http://127.0.0.1:8000/api/tourism/chengdu")
        .then((res) => res.json())
        .then((data) => {
          const spots = data.map((item) => item.spot);
          const counts = data.map((item) => item.visitor_count);
          const pieData = data.map((item) => ({
            name: item.spot,
            value: item.visitor_count,
          }));

          // 折线图
          echarts.init(document.getElementById("line")).setOption({
            xAxis: { type: "category", data: spots },
            yAxis: { type: "value" },
            series: [{ type: "line", data: counts }],
          });

          // 饼图
          echarts.init(document.getElementById("pie")).setOption({
            series: [{ type: "pie", radius: ["40%", "70%"], data: pieData }],
          });
        })
        // catch必须跟在then后面，不能断开
        .catch((err) => console.error("数据加载失败：", err));
    </script>
  </body>
</html>
